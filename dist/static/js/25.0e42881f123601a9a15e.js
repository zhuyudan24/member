webpackJsonp([25],{He19:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("WSiR"),n=a("AKaA"),o=a("NTL1"),s=a("8V46"),c={name:"cardvoucher",data:function(){return{checkVisible:!1,orderinfo:"",memberId:this.$route.query.memberId||"",navpath:[{name:"首页",path:""},{name:"微信会员",path:"/wechatmembers"},{name:"会员详情",path:"/wechatmemberDetail?memberId="+this.$route.query.memberId||""},{name:"会员卡券",path:""}],page:{currentPage:1,pageSize:20,totalCount:0},memberData:[],cardReviceCode:-1,dictList:[],useStatus:-1,model:{currentPage:1,pageSize:20,total:0},cardLogId:"",checkData:[]}},methods:{checkOrder:function(){var e=this;Object(n.a)(o.a.checkCard,{memberId:this.memberId,pageSize:this.model.pageSize,currentPage:this.model.currentPage,coupCardId:this.cardLogId,storeNameOrOrderNum:this.orderinfo}).then(function(t){0===t.data.errorCode?(e.checkData=t.data.result.result?t.data.result.result:[],e.model.total=t.data.result.totalCount):Object(s.a)(t.data.message)}).catch(function(e){Object(s.b)(e)})},handleCheckDestory:function(e){var t=this;this.cardLogId=e.cardLogId,Object(n.a)(o.a.checkCard,{memberId:this.memberId,pageSize:this.model.pageSize,currentPage:this.model.currentPage,coupCardId:this.cardLogId}).then(function(e){0===e.data.errorCode?(t.checkData=e.data.result.result?e.data.result.result:[],t.model.total=e.data.result.totalCount,t.checkVisible=!0):Object(s.a)(e.data.message)}).catch(function(e){Object(s.b)(e)})},handleModelSizeChange:function(e){this.model.pageSize=e,this.handleCheckDestory()},handleModelCurrentChange:function(e){this.model.currentPage=e,this.handleCheckDestory()},handleSearch:function(){this.page.currentPage=1,this.getMemberCardsPage()},getCardChannelType:function(){var e=this;Object(n.a)(o.a.cardChannelType,{businessType:"CARD_RECEIVE_TYPE"}).then(function(t){if(0!==t.data.errorCode)return Object(s.a)(t.data.message),!1;e.dictList=t.data.result.dictList}).catch(function(e){Object(s.b)(e)})},handleCardDestroy:function(e){var t=this;this.$confirm("您确定要销毁该卡券么，一旦销毁将无法恢复","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Object(n.a)(o.a.cardDestroy,{cardLogId:e.cardLogId,memberId:t.memberId}).then(function(e){if(0!==e.data.errorCode)return Object(s.a)(e.data.message),!1;Object(s.c)(),t.page.currentPage=1,t.getMemberCardsPage()}).catch(function(e){Object(s.b)(e)})}).catch(function(e){Object(s.b)(e)})},handleCurrentChange:function(e){this.page.currentPage=e,this.getMemberCardsPage()},handleSizeChange:function(e){this.page.pageSize=e,this.getMemberCardsPage()},goback:function(){this.$router.push({path:"wechatmemberDetail",query:{memberId:this.memberId}})},getMemberCardsPage:function(){var e=this;Object(n.a)(o.a.memberCardsPage,{memberId:this.memberId,pageSize:this.page.pageSize,currentPage:this.page.currentPage,cardReviceCode:this.cardReviceCode,useStatus:this.useStatus}).then(function(t){0===t.data.errorCode?(e.memberData=t.data.result.page.result,e.page.currentPage=t.data.result.page.currentPage,e.page.totalCount=t.data.result.page.totalCount):Object(s.a)(t.data.message)}).catch(function(e){Object(s.b)(e)})},choose:function(e){this.orderId=e.orderId},confirmBtn:function(){var e=this;this.cardLogId?this.checkData.length?Object(n.a)("/api-member/member-card-write-off",{memberId:this.memberId,cardLogId:this.cardLogId,orderId:this.orderId}).then(function(t){0===t.data.errorCode?(e.checkVisible=!1,Object(s.c)()):Object(s.a)(t.data.message)}).catch(function(e){Object(s.b)(e)}):this.$message.warning("没有可选的订单！"):Object(s.a)("订单ID不存在")}},created:function(){this.memberId&&this.getMemberCardsPage(),this.getCardChannelType(),this.$store.commit("mutations-slide",!1)},components:{"v-nav":r.a}},l={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"crad-con"},[a("div",{staticClass:"main-container min100"},[a("v-nav",{attrs:{navpath:e.navpath}}),e._v(" "),a("div",{staticClass:"card-warp"},[a("div",{staticClass:"table-container-member"},[a("div",{staticClass:"mBottom20"},[a("el-select",{staticStyle:{"margin-right":"7px"},attrs:{placeholder:"所有渠道"},on:{change:e.handleSearch},model:{value:e.cardReviceCode,callback:function(t){e.cardReviceCode=t},expression:"cardReviceCode"}},[a("el-option",{key:-1,attrs:{label:"所有渠道",value:-1}}),e._v(" "),e._l(e.dictList,function(e){return a("el-option",{key:e.dictCode,attrs:{label:e.dictName,value:e.dictCode}})})],2),e._v(" "),a("el-select",{attrs:{placeholder:"所有状态"},on:{change:e.handleSearch},model:{value:e.useStatus,callback:function(t){e.useStatus=t},expression:"useStatus"}},[a("el-option",{key:-1,attrs:{label:"所有状态",value:-1}}),e._v(" "),a("el-option",{key:1,attrs:{label:"待领取",value:1}}),e._v(" "),a("el-option",{key:2,attrs:{label:"待使用",value:2}}),e._v(" "),a("el-option",{key:3,attrs:{label:"已发放",value:3}}),e._v(" "),a("el-option",{key:4,attrs:{label:"已领取",value:4}}),e._v(" "),a("el-option",{key:5,attrs:{label:"已使用",value:5}}),e._v(" "),a("el-option",{key:6,attrs:{label:"已到期",value:6}}),e._v(" "),a("el-option",{key:7,attrs:{label:"已销毁",value:7}})],1)],1),e._v(" "),a("div",{staticClass:"mBottom40"},[a("div",{staticClass:"table-content"},[a("el-table",{ref:"multipleTable",attrs:{data:e.memberData,"tooltip-effect":"dark"}},[a("el-table-column",{attrs:{prop:"putOnTime",label:"投放时间",width:"160px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                  "+e._s(e._f("formatTime")(t.row.putOnTime))+"\n                ")]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"receiveTime",label:"领取时间",width:"160px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                  "+e._s(e._f("formatTime")(t.row.receiveTime))+"\n                ")]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"receiveName",label:"投放渠道"}}),e._v(" "),a("el-table-column",{attrs:{prop:"cardName",label:"卡券名称"}}),e._v(" "),a("el-table-column",{attrs:{prop:"cardCode",label:"卡券代码"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.cardCode?a("span",[e._v(e._s(t.row.cardCode))]):a("span",[e._v("--")])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"status",label:"状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[-1===t.row.status?a("span",[e._v("所有")]):e._e(),e._v(" "),1===t.row.status?a("span",[e._v("待领取")]):e._e(),e._v(" "),2===t.row.status?a("span",[e._v("待使用")]):e._e(),e._v(" "),3===t.row.status?a("span",[e._v("已发放")]):e._e(),e._v(" "),4===t.row.status?a("span",[e._v("已领取")]):e._e(),e._v(" "),5===t.row.status?a("span",[e._v("已使用")]):e._e(),e._v(" "),6===t.row.status?a("span",[e._v("已到期")]):e._e(),e._v(" "),7===t.row.status?a("span",[e._v("已销毁")]):e._e(),e._v(" "),8===t.row.status?a("span",[e._v("已占用")]):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"saleAmount",label:"销售额"}}),e._v(" "),a("el-table-column",{attrs:{prop:"checkSource",label:"核销来源"},scopedSlots:e._u([{key:"default",fn:function(t){return[0===t.row.checkSource?a("span",[e._v("订单核销")]):e._e(),e._v(" "),1===t.row.checkSource?a("span",[e._v("手动核销")]):e._e(),e._v(" "),-1===t.row.checkSource?a("span",[e._v("--")]):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"operate"},[4===t.row.status?a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.handleCheckDestory(t.row)}}},[e._v("核销")]):e._e(),e._v(" "),4===t.row.status?a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.handleCardDestroy(t.row)}}},[e._v("销毁")]):a("span",{staticClass:"pointer"},[e._v("--")])],1)]}}])})],1),e._v(" "),e.memberData.length>0?a("div",{staticClass:"page mTop20"},[a("el-pagination",{attrs:{background:"","current-page":e.page.currentPage,"page-sizes":[20,40,60,80],"page-size":e.page.pageSize,layout:"total, sizes, prev, pager, next",total:e.page.totalCount},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1):e._e()],1)])])]),e._v(" "),a("el-dialog",{attrs:{title:"选择订单",visible:e.checkVisible,width:"40%","close-on-click-modal":!1},on:{"update:visible":function(t){e.checkVisible=t}}},[a("div",{staticClass:"check-box"},[a("div",[a("el-input",{staticStyle:{width:"220px"},attrs:{placeholder:"输入门店信息/订单流水号","prefix-icon":"el-icon-search"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.checkOrder(t)}},model:{value:e.orderinfo,callback:function(t){e.orderinfo=t},expression:"orderinfo"}}),e._v(" "),a("span",{staticStyle:{float:"right","line-height":"36px"}},[e._v("\n            *仅显示满足核销条件的订单\n          ")])],1),e._v(" "),a("div",{staticClass:"table",staticStyle:{"margin-top":"20px","max-height":"400px",overflow:"scroll"}},[[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.checkData,"tooltip-effect":"dark"}},[a("el-table-column",{attrs:{prop:"storeName",label:"消费门店"}}),e._v(" "),a("el-table-column",{attrs:{prop:"orderNumber",label:"订单流水号"}}),e._v(" "),a("el-table-column",{attrs:{prop:"address",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"success",plain:""},on:{click:function(a){return e.choose(t.row)}}},[e._v("选取")])]}}])})],1)]],2),e._v(" "),e.model.total>0?a("div",{staticClass:"pager",staticStyle:{float:"right",margin:"10px 0"}},[a("el-pagination",{attrs:{background:"","current-page":e.model.currentPage,"page-sizes":[20,50,75,100],"page-size":e.model.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.model.total},on:{"size-change":e.handleModelSizeChange,"current-change":e.handleModelCurrentChange}})],1):e._e()]),e._v(" "),a("div",{staticClass:"dilog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.checkVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.confirmBtn}},[e._v("确 定")])],1)])],1),e._v(" "),a("div",{staticClass:"footer-box foot-add"},[a("vue-gic-footer")],1)])},staticRenderFns:[]};var i=a("VU/8")(c,l,!1,function(e){a("qLyE")},"data-v-6e192e54",null);t.default=i.exports},qLyE:function(e,t){}});