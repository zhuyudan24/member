webpackJsonp([11],{EOvX:function(e,t,a){"use strict";t.a=function(e,t){var a={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length)));for(var r in a)new RegExp("("+r+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?a[r]:("00"+a[r]).substr((""+a[r]).length)));return t}},H2nA:function(e,t){},Z0Oe:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("Dd8w"),n=a.n(r),i=a("mvHQ"),l=a.n(i),o=a("WSiR"),s=a("AKaA"),c=a("EOvX"),d=a("NTL1"),u=a("8V46"),m=a("UXnk"),g={name:"talkLogPage",data:function(){return{mainRequired:!1,memberId:this.$route.query.memberId||"",navpath:[{name:"首页",path:""},{name:"微信会员",path:"/wechatmembers"},{name:"会员详情",path:"/wechatmemberDetail?memberId="+this.$route.query.memberId},{name:"积分明细",path:"/integralDataPage?memberId="+this.$route.query.memberId},{name:"会员积分调整",path:""}],page:{currentPage:1,pageSize:20,totalCount:0},memberData:[],rangeVal:[Object(c.a)(new Date(+new Date-2592e6),"yyyy-MM-dd"),Object(c.a)(new Date,"yyyy-MM-dd")],intervalInOut:1,dictCode:-1,searchStr:"",searchType:1,beginTime:"",endTime:"",storeName:"",dictList:[],dilogIntegralVisible:!1,IntegralForm:{editType:1,accumulatPoints:0,remark:"",mainPartStoreId:"",cash:""},storeList:[],loading:!1,rules:{accumulatPoints:[{required:!0,message:"请选择调整额度",trigger:"change"}],remark:[{required:!0,message:"请输入原因备注",trigger:"change"}],cash:[{required:!0,message:"请输入成本金额",trigger:"change"}]},integralFlag:"",deductionType:1}},computed:{remarkTotal:function(){return this.IntegralForm.remark.length}},filters:{formatTimeYMD:function(e){return"--"!=e?e.split(" ")[0]:"--"},formatTimeHMS:function(e){return"--"!=e?e.split(" ")[1]:"--"}},methods:{formatCash:function(e){var t=e.target.value;/^[0-9]+(.[0-9]{0,2})?$/.test(t)||(e.target.value="")},chooseDetails:function(){this.deductionType=2,this.mainRequired=!1},changeVal:function(e){e&&(this.mainRequired=!1)},submitIntegral:function(e){var t=this;this.$refs[e].validate(function(e){if(e){if("gic"==t.integralFlag&&1==t.deductionType&&1==t.IntegralForm.editType&&!t.IntegralForm.mainPartStoreId)return void(t.mainRequired=!0);if(2==t.deductionType){var a=t.memberData.reduce(function(e,t){return e+t.adjustPoint},0);if(t.IntegralForm.accumulatPoints!==a)return void t.$alert("调整额度与调整积分不匹配","提示",{confirmButtonText:"确定"})}var r=t.memberData.map(function(e){return{id:e.intervalLogId,val:e.adjustPoint}}),n={memberId:t.memberId,editType:t.IntegralForm.editType,accumulatPoints:t.IntegralForm.accumulatPoints,deductionType:t.deductionType,mainPartStoreId:t.IntegralForm.mainPartStoreId,remark:t.IntegralForm.remark,detailJson:l()(r)};t.submitFlag&&(t.submitFlag=!1,Object(s.a)(d.a.memberIntegralUpdate,n).then(function(e){0==e.data.errorCode?(t.submitFlag=!0,Object(u.c)(),t.$router.back()):(t.submitFlag=!0,Object(u.a)())}).catch(function(e){t.submitFlag=!0,Object(u.b)(e)}))}})},handleKeyup:function(e){this.getStoreCodeName(e)},getStoreCodeName:function(e){var t=this;e&&Object(s.b)(d.a.storeCodeName,{searchParam:e,flag:1}).then(function(e){t.loading=!0,0===e.data.errorCode?(t.loading=!1,t.storeList=e.data.result):Object(u.a)(e.data.message)}).catch(function(e){Object(u.b)(e)})},handleSearch:function(){this.page.currentPage=1,this.getIntegralDataPage()},handleCurrentChange:function(e){this.page.currentPage=e,this.getIntegralDataPage()},handleSizeChange:function(e){this.page.pageSize=e,this.getIntegralDataPage()},goback:function(){this.$router.push({path:"integralDataPage",query:{memberId:this.memberId}})},changeDate:function(e){this.getIntegralDataPage()},getIntegralDataPage:function(){var e=this,t={memberId:this.memberId,pageSize:this.page.pageSize,currentPage:this.page.currentPage,intervalInOut:this.intervalInOut,dictCode:this.dictCode,searchStr:this.searchStr,searchType:this.searchType,beginTime:this.rangeVal[0]?Object(c.a)(new Date(this.rangeVal[0]),"yyyy-MM-dd"):"",endTime:this.rangeVal[1]?Object(c.a)(new Date(this.rangeVal[1]),"yyyy-MM-dd"):"",storeName:this.storeName};Object(s.a)(d.a.integralDataPage,t).then(function(t){0===t.data.errorCode?t.data.result.page.result?(e.memberData=t.data.result.page.result.map(function(e){return n()({},e,{createTime:e.createTime?Object(c.a)(new Date(e.createTime),"yyyy-MM-dd hh:mm:ss"):"--",adjustPoint:0})}),e.page.currentPage=t.data.result.page.currentPage,e.page.totalCount=t.data.result.page.totalCount):(e.memberData=[],e.page.totalCount=0):Object(u.a)(t.data.message)}).catch(function(e){Object(u.b)(e)})},getIntegralOperateType:function(){var e=this;Object(s.a)(d.a.integralOperateType,{businessType:"member_integral",dictStatus:1}).then(function(t){0===t.data.errorCode?e.dictList=t.data.result.dictList:Object(u.a)()}).catch(function(e){Object(u.b)(e)})},getEnterpriseInfo:function(){var e=this;Object(s.a)(d.a.enterpriseInfo).then(function(t){0==t.data.errorCode?(e.integralFlag=t.data.result.enterpriseInfo.integralFlag,"gic"==e.integralFlag&&e.memberId&&e.getIntegralDataPage()):Object(u.a)()}).catch(function(e){Object(u.b)(e)})}},created:function(){this.submitFlag=!0,this.memberId&&(this.getEnterpriseInfo(),this.getIntegralOperateType(),this.$store.commit("mutations-slide",!1))},components:{"v-nav":o.a,searchinput:m.a}},p={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"minwidth1200"},[a("v-nav",{attrs:{navpath:e.navpath}}),e._v(" "),a("div",{staticClass:"wrap modify-container"},[a("el-form",{ref:"IntegralForm",attrs:{model:e.IntegralForm,rules:e.rules,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"调整积分",prop:"editType"}},[a("el-radio-group",{model:{value:e.IntegralForm.editType,callback:function(t){e.$set(e.IntegralForm,"editType",t)},expression:"IntegralForm.editType"}},[a("el-radio",{attrs:{label:1}},[e._v("增加积分")]),e._v(" "),a("el-radio",{attrs:{label:2}},[e._v("扣除积分")])],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"调整额度",prop:"accumulatPoints"}},[a("el-input-number",{attrs:{"controls-position":"right",min:1,max:1e5},model:{value:e.IntegralForm.accumulatPoints,callback:function(t){e.$set(e.IntegralForm,"accumulatPoints",t)},expression:"IntegralForm.accumulatPoints"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"原因备注",prop:"remark"}},[a("el-input",{staticStyle:{width:"400px"},attrs:{type:"textarea",maxlength:50},model:{value:e.IntegralForm.remark,callback:function(t){e.$set(e.IntegralForm,"remark",t)},expression:"IntegralForm.remark"}}),e._v(" "),a("div",{staticClass:"remark-limit"},[e._v(e._s(e.remarkTotal)+"/50")])],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"gic"==e.integralFlag,expression:"integralFlag == 'gic'"}],attrs:{label:"原始成本主体"}},[a("div",[a("span",{staticClass:"is-require",staticStyle:{color:"red",float:"left","margin-left":"-105px"}},[e._v("*")]),e._v(" "),a("span",{staticClass:"pointer",on:{click:function(t){e.deductionType=1}}},[a("span",{staticClass:"el-radio__input",class:{"is-checked":1==e.deductionType}},[a("span",{staticClass:"el-radio__inner"})]),e._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:1==e.IntegralForm.editType,expression:"IntegralForm.editType == 1"}],staticClass:"el-radio__label"},[e._v("选择主体")]),e._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:2==e.IntegralForm.editType,expression:"IntegralForm.editType == 2"}],staticClass:"el-radio__label"},[e._v("遵循先进先出原则")])]),e._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:1==e.IntegralForm.editType,expression:"IntegralForm.editType == 1"}],staticClass:"pointer",staticStyle:{"margin-left":"25px"},on:{click:e.chooseDetails}},[a("span",{staticClass:"el-radio__input",class:{"is-checked":2==e.deductionType}},[a("span",{staticClass:"el-radio__inner"})]),e._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:1==e.IntegralForm.editType,expression:"IntegralForm.editType == 1"}],staticClass:"el-radio__label"},[e._v("选择明细")])])]),e._v(" "),a("el-select",{directives:[{name:"show",rawName:"v-show",value:1==e.deductionType&&1==e.IntegralForm.editType,expression:"deductionType == 1 && IntegralForm.editType == 1"}],attrs:{filterable:"",clearable:"",remote:"","reserve-keyword":"","remote-method":e.handleKeyup,placeholder:"请输入原始成本主体名称",loading:e.loading},on:{change:e.changeVal},model:{value:e.IntegralForm.mainPartStoreId,callback:function(t){e.$set(e.IntegralForm,"mainPartStoreId",t)},expression:"IntegralForm.mainPartStoreId"}},e._l(e.storeList,function(e){return a("el-option",{key:e.storeId,attrs:{label:e.storeName,value:e.storeId}})}),1),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.mainRequired,expression:"mainRequired"}],staticStyle:{color:"#f00","font-size":"14px"}},[e._v("主体为必填内容")])],1)],1)],1),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:2==e.deductionType&&1==e.IntegralForm.editType,expression:"deductionType == 2 && IntegralForm.editType == 1"}],staticClass:"table-container"},[a("div",{staticClass:"mBottom20"},[a("el-row",[a("el-col",{attrs:{span:12}},[a("el-date-picker",{attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},on:{change:e.changeDate},model:{value:e.rangeVal,callback:function(t){e.rangeVal=t},expression:"rangeVal"}}),e._v(" "),a("el-select",{attrs:{placeholder:"所有事由"},on:{change:e.handleSearch},model:{value:e.dictCode,callback:function(t){e.dictCode=t},expression:"dictCode"}},[a("el-option",{key:-1,attrs:{label:"所有事由",value:-1}}),e._v(" "),e._l(e.dictList,function(e,t){return a("el-option",{key:t,attrs:{label:e.dictName,value:e.dictCode}})})],2)],1),e._v(" "),a("div",{attrs:{span:12}},[a("div",{staticClass:"displayflex tr"},[a("div",{staticClass:"flex"},[a("el-input",{staticStyle:{width:"200px"},attrs:{"prefix-icon":"el-icon-search",placeholder:"请输入会员名称",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch(t)}},model:{value:e.searchStr,callback:function(t){e.searchStr=t},expression:"searchStr"}})],1)])])],1)],1),e._v(" "),a("div",{staticClass:"mBottom40"},[a("div",{staticClass:"table-content"},[a("el-table",{ref:"multipleTable",attrs:{data:e.memberData,"tooltip-effect":"dark"}},[a("el-table-column",{attrs:{prop:"callBeginTime",label:"时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[e._v(e._s(e._f("formatTimeYMD")(t.row.createTime)))]),e._v(" "),a("div",[e._v(e._s(e._f("formatTimeHMS")(t.row.createTime)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"intervalInout",label:"日志类型"},scopedSlots:e._u([{key:"default",fn:function(t){return[1==t.row.intervalInout?a("span",[e._v("积分获取")]):e._e(),e._v(" "),2==t.row.intervalInout?a("span",[e._v("积分扣除")]):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"intervalHistory",label:"日志详情"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{style:{color:t.row.intervalHistory>0?"#00c52d":"red"}},[e._v(e._s(t.row.intervalHistory>0?"+":"-")+e._s(t.row.intervalHistory))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"memberIntegralName",label:"事由"}}),e._v(" "),a("el-table-column",{attrs:{prop:"remark",label:"备注"}}),e._v(" "),a("el-table-column",{attrs:{prop:"mainStoreName",label:"主门店"}}),e._v(" "),a("el-table-column",{attrs:{prop:"intervalEffect",label:"可扣积分"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.intervalEffect?a("span",[e._v(e._s(t.row.intervalEffect))]):a("span",[e._v("--")])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"",label:"调整积分",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"adjust-points"},[1==e.IntegralForm.editType?a("el-input-number",{attrs:{"controls-position":"right",min:0,max:1e5},model:{value:t.row.adjustPoint,callback:function(a){e.$set(t.row,"adjustPoint",a)},expression:"scope.row.adjustPoint"}}):e._e(),e._v(" "),2==e.IntegralForm.editType?a("el-input-number",{attrs:{"controls-position":"right",min:0,max:t.row.intervalHistory},model:{value:t.row.adjustPoint,callback:function(a){e.$set(t.row,"adjustPoint",a)},expression:"scope.row.adjustPoint"}}):e._e()],1)]}}])})],1),e._v(" "),e.page.totalCount>0?a("div",{staticClass:"page mTop20"},[a("el-pagination",{attrs:{background:"","current-page":e.page.currentPage,"page-sizes":[20,40,60,80],"page-size":e.page.pageSize,layout:"total, sizes, prev, pager, next",total:e.page.totalCount},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1):e._e()],1)])]),e._v(" "),a("div",{staticClass:"footwrap"},[a("el-button",{attrs:{plain:""},on:{click:e.goback}},[e._v("返 回")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitIntegral("IntegralForm")}}},[e._v("确认调整")])],1)],1)},staticRenderFns:[]};var h=a("VU/8")(g,p,!1,function(e){a("H2nA")},null,null);t.default=h.exports}});