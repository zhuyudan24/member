webpackJsonp([21],{"kME+":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("Dd8w"),a=s.n(i),n=s("WSiR"),r=s("AKaA"),l=s("oAV5"),o=s("8V46"),c=s("NTL1"),m=s("162o"),u=s("SJI6"),f={name:"forzenlist",components:{NavPath:n.a},data:function(){return{navpath:[{name:"首页",path:""},{name:"冻结会员",path:"/frozenList"}],loading:!1,frozenOptions:[{label:"会员主动冻结",value:102},{label:"异常冻结",value:101}],total:null,frozenReason:"",reasonbtn:!0,keywords:"",currentPage:1,remark:"",currentIndex:0,memberList:[],frozenList:[],middleList:[],frozenMembers:[],singleInfo:{sex:0,age:0,cardNo:0,mainStoreName:"",costFee:0,costTimes:0,lastCost:0,numOfSale:0,numOfmarket:0,couponCount:0,status:0,wxStatus:0,phoneStatus:0,authStatus:0}}},computed:a()({forzenShow:function(){return this.$store.state.forzenList}},Object(u.mapState)(["storeImageUrl"])),created:function(){var t=this;this.storeImageUrl||this.$store.dispatch("getStorePicture"),this.$store.commit("mutations-slide",!0),this.$store.commit("forzen-list",!1),this.$nextTick(function(e){t.$store.commit("forzen-list",!0)}),this.memberType=["微信会员","POS会员"],this.midSelect=[]},beforeMount:function(){this.getList({pSize:10,cPage:1})},filters:{formatTimeYMD:function(t){return"--"!=t?t.split(" ")[0]:"--"},formatTimeHMS:function(t){return"--"!=t?t.split(" ")[1]:"--"},formatCardName:function(t){return t&&t.length>10&&(t=t.substr(0,10)+"..."),t}},mounted:function(){var t=this;Object(m.setTimeout)(function(){var e=t.$refs.memberlist.clientHeight;t.$refs.forzenlist.style.height=e+"px"},100)},methods:{selectAllmultipleList:function(){var t=this;this.selectAll=!this.selectAll,this.selectAll?this.memberData.forEach(function(e){t.$refs.multipleTable.toggleRowSelection(e,!0)}):this.$refs.multipleTable.clearSelection()},linkDetail:function(t,e){2==e?this.$router.push({path:"/posmemberDetail",query:{memberId:t}}):this.$router.push({path:"/wechatmemberDetail",query:{memberId:t}})},getList:function(t){var e=this,s={pageSize:t.pSize,currentPage:t.cPage,frozenType:-1,phoneNameCard:this.keywords,wxOrPos:0==this.currentIndex?1:2,fieldNames:"name,nickName,photoUrl,cardNo,crateCardDateString,wxMember,posMember"};Object(r.a)("/api-member/ajax-members-do-frozen",s).then(function(t){0===t.data.errorCode?t.data.result.result.length>0?(e.frozenList=t.data.result.result.map(function(t){return a()({},t,{cardNum:t.cardNum?t.cardNum:"--",crateCardDateString:t.crateCardDateString?Object(l.a)(t.crateCardDateString,1):"--",thirdImgUrl:t.thirdImgUrl?t.thirdImgUrl:e.storeImageUrl})}),e.total=t.data.result.totalCount):e.frozenList=[]:Object(o.a)(t.data.message)})},submit:function(){this.getList({pSize:10,cPage:1})},handleCurrentChange:function(t){this.currentPage=t,this.getList({pSize:10,cPage:t})},removeItem:function(t){var e=this,s=this.middleList[t].memberId;this.memberList.length&&this.memberList.forEach(function(t){s==t.memberId&&e.$refs.multipleTable.toggleRowSelection(t,!1)}),this.middleList.splice(t,1)},showSingleInfo:function(t){var e=this;this.singleInfo="",Object(r.a)(c.a.singleInfo,{memberId:t}).then(function(t){if(0===t.data.errorCode){var s=t.data.result.memberSingle;e.singleInfo=a()({},s,{sex:0==s.sex?"性别未知":1==s.sex?"男":"女",age:0!=s.age?s.age:"年龄未知",cardNo:s.cardNo?s.cardNo:"无会员卡",mainStoreName:s.mainStoreName?s.mainStoreName:"主门店未知"})}else Object(o.a)(t.data.message)})},frozenAll:function(){var t=this;this.middleList.length?this.frozenReason?this.$confirm("是否冻结所选会员?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.frozenMethod()}):this.frozenReasonFlag=!0:this.$alert("请先选择冻结选项","提示",{confirmButtonText:"确定"})},changeReason:function(t){t&&(this.reasonbtn=!1)},frozenMethod:function(){var t=this;this.ids=[],this.middleList.forEach(function(e){t.ids.push(e.memberId)});var e={memberIds:this.ids.join(","),remark:this.remark,isCurrent:0,status:1,frozenType:this.frozenReason};Object(r.a)("/api-member/members-batch-update-frozen",e).then(function(e){0===e.data.errorCode?(t.frozenReason="",t.remark="",t.middleList.length=0,t.loading=!0,Object(m.setTimeout)(function(){t.loading=!1,t.$message({message:"冻结成功",type:"success"}),t.$router.push({path:"/frozenList"})},5e3)):Object(o.a)(e.data.message)}).catch(function(t){Object(o.a)(t)})},changeType:function(t){this.currentIndex=t,this.getList({pSize:10,cPage:1})},handleSelectionChange:function(t){var e=this;if(0!=t.length){this.memberList=t;for(var s=null,i=[],a=function(t,s){0==e.middleList.length&&e.middleList.push(e.memberList[0]),-1==e.middleList.findIndex(function(s){return s.memberId==e.memberList[t].memberId})&&e.middleList.push(e.memberList[t])},n=0,r=this.memberList.length;n<r;n++)a(n);if(this.midSelect.length>this.memberList.length){n=0;for(var l=this.midSelect.length;n<l;n++)for(var o=this.midSelect[n].memberId,c=0,m=this.memberList.length;c<m;c++)o==this.memberList[c].memberId&&(i[n]=n)}for(var u=0;u<i.length;u++)void 0===i[u]&&(s=u);var f=null!=s?this.midSelect[s].memberId:null;f&&(this.middleList=this.middleList.filter(function(t){return t.memberId!=f})),this.midSelect=t}else this.middleList=t}}},d={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"frozen-list"},[s("div",{staticClass:"min100"},[s("nav-path",{attrs:{navpath:t.navpath}}),t._v(" "),s("div",{staticClass:"member-forzen-container"},[t.forzenShow?s("div",{ref:"memberlist",staticClass:"list"},[t._m(0),t._v(" "),s("div",{staticClass:"search-box"},[s("el-input",{staticStyle:{width:"260px"},attrs:{maxlength:"11",placeholder:"请输入会员姓名/卡号/手机号码",clearable:""},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.submit(e)}},model:{value:t.keywords,callback:function(e){t.keywords=e},expression:"keywords"}},[s("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"prefix"},slot:"prefix"})]),t._v(" "),s("div",{staticClass:"switch-member"},t._l(t.memberType,function(e,i){return s("el-button",{key:i,class:{active:i==t.currentIndex},on:{click:function(e){return t.changeType(i)}}},[t._v("\n              "+t._s(e)+"\n            ")])}),1)],1),t._v(" "),s("div",{staticClass:"table-list"},[[s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:t.frozenList,"tooltip-effect":"dark"},on:{"selection-change":t.handleSelectionChange}},[s("el-table-column",{attrs:{type:"selection",width:"55"}}),t._v(" "),s("el-table-column",{attrs:{prop:"frozenMember",label:"基本信息"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("div",{staticClass:"basic-info-table",staticStyle:{cursor:"pointer"},on:{click:function(s){return t.linkDetail(e.row.memberId,e.row.channel)}}},[s("el-popover",{attrs:{placement:"top-start",width:"400",height:"180",trigger:"hover"},on:{show:function(s){return t.showSingleInfo(e.row.memberId)}}},[s("div",{staticClass:"pointer"},[s("div",{staticClass:"singelinfo"},[s("div",{staticClass:"singelinfo-img"},[s("img",{attrs:{width:"100",height:"100",src:e.row.thirdImgUrl?e.row.thirdImgUrl:"./static/img/default.png",alt:""}})]),t._v(" "),s("div",{staticClass:"singelinfo-content pLeft10 pRight10"},[s("span",{staticClass:"lheigth0"},[t._v(t._s(e.row.memberName)+"\n                              "),s("span",{staticClass:"channelicon fr",class:0==t.singleInfo.status?"xcxicongray":1==t.singleInfo.status?"xcxicon":"",attrs:{title:0==t.singleInfo.status?"未关注微信服务号":1==t.singleInfo.status?"已关注微信服务号":""}}),t._v(" "),s("span",{staticClass:"channelicon fr mr6",class:0==t.singleInfo.wxStatus?"gzhicongray":1==t.singleInfo.wxStatus?"gzhicon":"gzhiconcanclegray",attrs:{title:0==t.singleInfo.wxStatus?"未使用公众号":1==t.singleInfo.wxStatus?"未使用公众号":""}})]),t._v(" "),s("p",{staticClass:"lheigth0"},[s("span",{staticClass:"evl-right"},[t._v(t._s(t.singleInfo.sex))]),s("span",{staticClass:"evl-right"},[t._v(t._s(t.singleInfo.age))]),s("span",{attrs:{title:t.singleInfo.cardNo}},[t._v(t._s(t._f("formatCardName")(t.singleInfo.cardNo)))])]),t._v(" "),s("p",{staticClass:"lheigth0"},[s("span",{staticClass:"fix-block"},[t._v(t._s(t.singleInfo.mainStoreName))])]),t._v(" "),s("div",{staticClass:"singelinfo-cost"},[s("div",{staticClass:"singelinfo-costitem"},[s("p",[t._v(t._s(t.singleInfo.costFee))]),t._v(" "),s("p",[t._v("消费总额")])]),t._v(" "),s("div",{staticClass:"singelinfo-costitem"},[s("p",[t._v(t._s(t.singleInfo.costTimes))]),t._v(" "),s("p",[t._v("消费次数")])]),t._v(" "),s("div",{staticClass:"singelinfo-costitem"},[s("p",[t._v(t._s(t.singleInfo.lastCost))]),t._v(" "),s("p",[t._v("最近消费")])])])])]),t._v(" "),s("div",{staticClass:"singelinfo-jl mBottom20 mTop20"},[s("a",{staticClass:"singelinfo-jlitem"},[t._v("消费记录 ("+t._s(t.singleInfo.numOfSale)+")")]),t._v(" "),s("a",{staticClass:"singelinfo-jlitem"},[t._v("营销记录 ("+t._s(t.singleInfo.numOfmarket)+")")]),t._v(" "),s("a",{staticClass:"singelinfo-jlitem"},[t._v("卡券记录 ("+t._s(t.singleInfo.couponCount)+")")])])]),t._v(" "),s("span",{staticClass:"member-span",attrs:{slot:"reference"},slot:"reference"},[s("img",{staticClass:"tablecontent-cellimg mr6",attrs:{width:"60",height:"60",src:e.row.thirdImgUrl?e.row.thirdImgUrl:"./static/img/default.png",alt:""}})])]),t._v(" "),s("span",{staticClass:"fix-block"},[t._v(t._s(e.row.memberName))])],1)]}}],null,!1,1043636704)}),t._v(" "),s("el-table-column",{attrs:{prop:"cardNum",label:"会员卡号"}}),t._v(" "),s("el-table-column",{attrs:{prop:"crateCardDateString",label:"开卡时间"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("div",[t._v(t._s(t._f("formatTimeYMD")(e.row.crateCardDateString)))]),t._v(" "),s("div",[t._v(t._s(t._f("formatTimeHMS")(e.row.crateCardDateString)))])]}}],null,!1,2458402294)})],1)]],2),t._v(" "),t.total>0?s("div",{staticClass:"pager"},[s("el-pagination",{attrs:{"page-size":20,currentPage:t.currentPage,layout:"prev, pager, next",total:t.total},on:{"current-change":t.handleCurrentChange}})],1):t._e()]):t._e(),t._v(" "),s("div",{ref:"forzenlist",staticClass:"choose-member"},[s("div",{ref:"forzenMemberList",staticClass:"mem-list"},[s("div",{staticClass:"al-members"},[t._v("\n            已选择冻结会员\n            "),s("span",{staticClass:"per-num"},[t._v(t._s(t.middleList.length)+"/人")])]),t._v(" "),s("ul",{staticClass:"member-list"},t._l(t.middleList,function(e,i){return s("li",{key:i,staticClass:"list-item"},[s("div",{staticClass:"basic-info"},[s("img",{staticClass:"list-img",attrs:{src:e.thirdImgUrl?e.thirdImgUrl:"./static/img/default.png"}}),t._v(" "),s("span",{staticClass:"txt"},[t._v(t._s(e.memberName))])]),t._v(" "),s("i",{staticClass:"el-icon-circle-close-outline icon-close",on:{click:function(e){return t.removeItem(i)}}})])}),0)]),t._v(" "),t._m(1),t._v(" "),s("el-select",{attrs:{placeholder:"请选择"},on:{change:t.changeReason},model:{value:t.frozenReason,callback:function(e){t.frozenReason=e},expression:"frozenReason"}},t._l(t.frozenOptions,function(t){return s("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1),t._v(" "),s("p",{staticClass:"remark-txt"},[t._v("备注")]),t._v(" "),s("gic-input",{attrs:{max:20},model:{value:t.remark,callback:function(e){t.remark=e},expression:"remark"}}),t._v(" "),s("div",{staticClass:"operator-btn"},[s("el-button",[s("router-link",{attrs:{to:"/frozenList"}},[t._v("返回")])],1),t._v(" "),s("el-button",{attrs:{type:"primary",disabled:t.reasonbtn},on:{click:t.frozenAll}},[t._v("冻结选中会员")])],1)],1)])],1),t._v(" "),s("div",{staticClass:"foot-add"},[s("vue-gic-footer")],1)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"switch"},[e("span",[this._v("会员列表")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",{staticClass:"title"},[e("b",{staticClass:"key"},[this._v("*")]),this._v("冻结原因")])}]};var h=s("VU/8")(f,d,!1,function(t){s("kTur")},"data-v-79ebe8ee",null);e.default=h.exports},kTur:function(t,e){}});